<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Loan Calculators</title>
  <style>
    :root {
      --bg: #f4f5f7;
      --card-bg: #ffffff;
      --accent: #2563eb;
      --accent-light: #dbeafe;
      --text-main: #111827;
      --text-muted: #6b7280;
      --border: #e5e7eb;
      --error: #b91c1c;
      --radius: 12px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: var(--bg);
      color: var(--text-main);
      line-height: 1.5;
    }

    header {
      background: #111827;
      color: #f9fafb;
      padding: 0.75rem 1rem;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .nav {
      max-width: 960px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      flex-wrap: wrap;
    }

    .nav-brand {
      font-weight: 700;
      letter-spacing: 0.03em;
      text-decoration: none;
      color: inherit;
    }

    .nav-links {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      font-size: 0.875rem;
    }

    .nav-links a {
      color: #e5e7eb;
      text-decoration: none;
      padding: 0.25rem 0.5rem;
      border-radius: 999px;
    }

    .nav-links a:hover {
      background: rgba(255, 255, 255, 0.08);
    }

    .nav-links a.active {
      background: rgba(255, 255, 255, 0.16);
      color: #f9fafb;
    }

    main {
      max-width: 960px;
      margin: 1rem auto 2.5rem;
      padding: 0 1rem;
    }

    .welcome-blurb {
      margin-bottom: 0.5rem;
      color: #374151;
      font-size: 0.95rem;
    }

    /* Wrap select so custom styles apply consistently */
    .loan-selector-wrapper {
    position: relative;
    display: inline-block;
    }

    /* Calculator selector (dropdown) */
    .loan-selector {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 1rem;
      font-size: 0.9rem;
    }

    .loan-selector-label {
      font-weight: 500;
    }

    /* Style the select box */
    .loan-selector-select {
    min-width: 220px;
    max-width: 100%;
    padding: 0.45rem 0.75rem;
    border-radius: 999px;
    border: 1px solid var(--border);
    background: #f9fafb;
    font-size: 0.9rem;
    font-family: inherit;        /* Ensures match */
    color: var(--text-main);
    outline: none;
    appearance: none;            /* Removes browser default dropdown arrow */
    -webkit-appearance: none;
    -moz-appearance: none;
    background-image: url("data:image/svg+xml;utf8,<svg fill='%236b7280' height='18' width='18' xmlns='http://www.w3.org/2000/svg'><path d='M5 7l4 4 4-4z'/></svg>");
    background-repeat: no-repeat;
    background-position: right 0.65rem center;
    background-size: 14px;
    }

    /* Hover + focus for select */
    .loan-selector-select:hover {
    background: #f3f4f6;
    }

    .loan-selector-select:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 1px var(--accent-light);
    background: white;
    }

    /* Style the dropdown items (limited support) */
    .loan-selector-select option {
    font-family: inherit;
    font-size: 0.9rem;
    color: #111827;
    }
    
    .card {
      background: var(--card-bg);
      border-radius: var(--radius);
      padding: 1.25rem 1rem;
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.08);
      margin-bottom: 1.25rem;
    }

    @media (min-width: 640px) {
      .card {
        padding: 1.75rem 1.5rem;
      }
    }

    h1,
    h2 {
      margin-top: 0;
      margin-bottom: 0.4rem;
      font-size: 1.4rem;
    }

    h2 {
      font-size: 1.2rem;
    }

    .subtitle {
      margin: 0 0 1.1rem;
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    /* Buttons / shared */
    button {
      border: none;
      cursor: pointer;
      font-size: 0.9rem;
      border-radius: 999px;
      padding: 0.45rem 0.9rem;
      font-weight: 500;
      white-space: nowrap;
    }

    .btn-primary {
      background: var(--accent);
      color: #f9fafb;
    }

    .btn-primary:hover {
      background: #1d4ed8;
    }

    .btn-secondary {
      background: #f3f4f6;
      color: #111827;
    }

    .btn-secondary:hover {
      background: #e5e7eb;
    }

    .error {
      color: var(--error);
      font-size: 0.85rem;
      margin-top: 0.35rem;
    }

    .muted {
      color: var(--text-muted);
      font-size: 0.8rem;
      margin-top: 0.75rem;
    }

    footer {
      max-width: 960px;
      margin: 0 auto 2rem;
      padding: 0 1rem;
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    footer p {
      margin: 0.35rem 0;
    }

    /* Missing loan term form */
    .loan-form {
      display: flex;
      flex-direction: column;
      gap: 0.9rem;
    }

    .loan-row {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 0.5rem;
    }

    .loan-label-wrap {
      flex: 1 1 220px;
      display: flex;
      align-items: center;
      gap: 0.35rem;
    }

    .loan-label {
      font-size: 0.9rem;
      font-weight: 500;
    }

    .loan-field {
      flex: 1 1 200px;
      display: flex;
      align-items: center;
    }

    .loan-input {
      flex: 1 1 auto;
      font-size: 0.9rem;
      border-radius: 999px;
      border: 1px solid var(--border);
      padding: 0.4rem 0.75rem;
      background: var(--bg);
      outline: none;
      min-width: 0;
    }

    .loan-input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px var(--accent-light);
      background: #ffffff;
    }

    .loan-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-top: 0.5rem;
    }

    /* Info icon */
    .info-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 1.3rem;
      height: 1.3rem;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #f9fafb;
      color: var(--text-muted);
      font-size: 0.75rem;
      padding: 0;
      flex-shrink: 0;
    }

    .info-btn:hover {
      background: #e5e7eb;
    }

    .info-btn:focus-visible {
      outline: 2px solid var(--accent);
      outline-offset: 1px;
    }

    /* Highlighted result field */
    .highlight-input {
      border-color: var(--accent) !important;
      box-shadow: 0 0 0 1px var(--accent-light);
      background: #eff6ff;
    }

    .info-separator {
      margin: 0.75rem 0 0.5rem;
      border: 0;
      border-top: 1px solid var(--border);
    }
  </style>
</head>
<body>
  <header>
    <nav class="nav">
      <a href="index.html" class="nav-brand">My Super Calculators</a>
      <div class="nav-links">
        <a href="index.html#budgeting">Budgeting</a>
        <a href="index.html#debt">Debt</a>
        <a href="index.html#credit">Credit Cards</a>
        <a href="loans.html" class="active" aria-current="page">Loans</a>
      </div>
    </nav>
  </header>

  <main>
    <div class="welcome-blurb">
      <strong>Loans.</strong> Select the loan calculator to view.
    </div>

    <!-- Dropdown selector that navigates to other pages -->
    <div class="loan-selector">
    <span class="loan-selector-label">Calculator:</span>

        <div class="loan-selector-wrapper">
            <select
            class="loan-selector-select"
            aria-label="Select loan calculator"
            onchange="if (this.value) window.location.href = this.value;"
            >
            <option value="loans.html" selected>Missing Loan Term</option>
            <option value="simple-loan.html">Simple Loan Calculator</option>
            </select>
        </div>
    </div>

    <section class="card" id="missing-loan-term">
      <h2>Missing Loan Term</h2>
      <p class="subtitle">
        If you know any three of a loan’s four core values (principal, interest
        rate, payments remaining, and payment amount), this calculator will
        calculate the missing value. Results are based on standard amortization
        formulas and are intended as close approximations.
      </p>

      <form id="missing-loan-form" class="loan-form" action="#">
        <div class="loan-row">
          <div class="loan-label-wrap">
            <span class="loan-label">Principal (current payoff amount)</span>
            <button
              type="button"
              class="info-btn"
              data-field="principal"
              aria-label="More information about principal"
            >
              i
            </button>
          </div>
          <div class="loan-field">
            <input
              type="text"
              name="principal"
              id="principal"
              class="loan-input"
              inputmode="decimal"
              placeholder="e.g., 237000"
            />
          </div>
        </div>

        <div class="loan-row">
          <div class="loan-label-wrap">
            <span class="loan-label">Interest rate (APR, %)</span>
            <button
              type="button"
              class="info-btn"
              data-field="interest"
              aria-label="More information about interest rate"
            >
              i
            </button>
          </div>
          <div class="loan-field">
            <input
              type="text"
              name="interest"
              id="interest"
              class="loan-input"
              inputmode="decimal"
              placeholder="e.g., 6.5"
            />
          </div>
        </div>

        <div class="loan-row">
          <div class="loan-label-wrap">
            <span class="loan-label">Number of payments remaining</span>
            <button
              type="button"
              class="info-btn"
              data-field="payments"
              aria-label="More information about payments remaining"
            >
              i
            </button>
          </div>
          <div class="loan-field">
            <input
              type="text"
              name="payments"
              id="payments"
              class="loan-input"
              inputmode="decimal"
              placeholder="e.g., 360"
            />
          </div>
        </div>

        <div class="loan-row">
          <div class="loan-label-wrap">
            <span class="loan-label">Payment amount</span>
            <button
              type="button"
              class="info-btn"
              data-field="payment"
              aria-label="More information about payment amount"
            >
              i
            </button>
          </div>
          <div class="loan-field">
            <input
              type="text"
              name="payment"
              id="payment"
              class="loan-input"
              inputmode="decimal"
              placeholder="e.g., 1500"
            />
          </div>
        </div>

        <div class="loan-actions">
          <button
            type="button"
            class="btn-primary"
            onclick="computeMissingValue()"
          >
            Compute missing value
          </button>
          <button
            type="button"
            class="btn-secondary"
            onclick="clearLoanForm()"
          >
            Clear
          </button>
        </div>

        <div id="loan-error" class="error" aria-live="polite"></div>
      </form>
      
      <hr class="info-separator" />

      <div class="muted" id="loan-term-details">
        Click an <strong>info</strong> icon next to a field to see more details
        about that value and how to think about it.
      </div>
    </section>
  </main>

  <footer>
    <p>
      Loan calculations are based on conventional amortizing loan formulas and
      your inputs. Actual lender calculations may differ slightly due to timing,
      compounding conventions, fees, or rounding. Treat these results as
      estimates rather than exact payoff figures.
    </p>
    <p>
      These tools are provided for general information and entertainment
      purposes only and do not constitute financial, legal, or tax advice. We
      are not a fiduciary and do not make recommendations based on your
      personal financial situation. Please consult a qualified professional for
      advice tailored to your needs before making major financial decisions.
    </p>
  </footer>

  <script>
    // ------- Helper numeric utilities -------

    function sn(num) {
      num = num.toString();
      var len = num.length;
      var rnum = "";
      var b = num.substring(0, 1);
      if (b === "-") rnum = "-";

      for (var i = 0; i <= len; i++) {
        b = num.substring(i, i + 1);
        if (
          b === "0" ||
          b === "1" ||
          b === "2" ||
          b === "3" ||
          b === "4" ||
          b === "5" ||
          b === "6" ||
          b === "7" ||
          b === "8" ||
          b === "9" ||
          b === "."
        ) {
          rnum = rnum + b;
        }
      }

      if (rnum === "" || rnum === "-") rnum = 0;
      return Number(rnum);
    }

    // Compute interest rate given n (payments), principal, payment amount, and a starting guess (APR in %)
    function computeIntRate(myNumPmts, myPrin, myPmtAmt, myGuess) {
      var myDecRate = 0;
      var myDecGuess;

      if (String(myGuess).length === 0 || myGuess === 0) {
        myDecGuess = 10;
      } else {
        myDecGuess = myGuess;
        if (myDecGuess >= 1) {
          myDecGuess = myDecGuess / 100;
        }
      }

      myDecRate = myDecGuess / 12;
      var myNewPmtAmt = 0;
      var pow = 1;

      for (var j = 0; j < myNumPmts; j++) {
        pow = pow * (1 + myDecRate);
      }

      myNewPmtAmt = (myPrin * pow * myDecRate) / (pow - 1);

      function pmtAtRate(rate) {
        var p = 1;
        for (var k = 0; k < myNumPmts; k++) {
          p = p * (1 + rate);
        }
        return (myPrin * p * rate) / (p - 1);
      }

      var decPlace2Rate = (myDecGuess + 0.01) / 12;
      var decPlace3Rate = (myDecGuess + 0.001) / 12;
      var decPlace4Rate = (myDecGuess + 0.0001) / 12;
      var decPlace5Rate = (myDecGuess + 0.00001) / 12;

      var decPlace2Amt = pmtAtRate(decPlace2Rate) - myNewPmtAmt;
      var decPlace3Amt = pmtAtRate(decPlace3Rate) - myNewPmtAmt;
      var decPlace4Amt = pmtAtRate(decPlace4Rate) - myNewPmtAmt;
      var decPlace5Amt = pmtAtRate(decPlace5Rate) - myNewPmtAmt;

      var myPmtDiff = 0;

      if (myNewPmtAmt < myPmtAmt) {
        while (myNewPmtAmt < myPmtAmt) {
          myPmtDiff = myPmtAmt - myNewPmtAmt;
          if (myPmtDiff > decPlace2Amt) {
            myDecRate += 0.01 / 12;
          } else if (myPmtDiff > decPlace3Amt) {
            myDecRate += 0.001 / 12;
          } else if (myPmtDiff > decPlace4Amt) {
            myDecRate += 0.0001 / 12;
          } else if (myPmtDiff > decPlace5Amt) {
            myDecRate += 0.00001 / 12;
          } else {
            myDecRate += 0.000001 / 12;
          }

          pow = 1;
          for (var m = 0; m < myNumPmts; m++) {
            pow = pow * (1 + myDecRate);
          }
          myNewPmtAmt = (myPrin * pow * myDecRate) / (pow - 1);
        }
      } else {
        while (myNewPmtAmt > myPmtAmt) {
          myPmtDiff = myNewPmtAmt - myPmtAmt;
          if (myPmtDiff > decPlace2Amt) {
            myDecRate -= 0.01 / 12;
          } else if (myPmtDiff > decPlace3Amt) {
            myDecRate -= 0.001 / 12;
          } else if (myPmtDiff > decPlace4Amt) {
            myDecRate -= 0.0001 / 12;
          } else if (myPmtDiff > decPlace5Amt) {
            myDecRate -= 0.00001 / 12;
          } else {
            myDecRate -= 0.000001 / 12;
          }

          pow = 1;
          for (var n = 0; n < myNumPmts; n++) {
            pow = pow * (1 + myDecRate);
          }
          myNewPmtAmt = (myPrin * pow * myDecRate) / (pow - 1);
        }
      }

      myDecRate = myDecRate * 12 * 100; // convert back to APR %
      return myDecRate;
    }

    function formatNumber(num, decimals) {
      if (!isFinite(num)) return "";
      var factor = Math.pow(10, decimals);
      return (Math.round(num * factor) / factor).toString();
    }

    // ------- Core calculator logic -------

    function clearHighlights() {
      var inputs = document.querySelectorAll(".loan-input");
      inputs.forEach(function (input) {
        input.classList.remove("highlight-input");
      });
    }

    function clearLoanForm() {
      document.getElementById("missing-loan-form").reset();
      document.getElementById("loan-error").textContent = "";
      clearHighlights();
      document.getElementById("loan-term-details").innerHTML =
        'Click an <strong>info</strong> icon next to a field to see more details about that value and how to think about it.';
    }

    function computeMissingValue() {
      var errorEl = document.getElementById("loan-error");
      errorEl.textContent = "";
      clearHighlights();

      var principalInput = document.getElementById("principal");
      var interestInput = document.getElementById("interest");
      var paymentsInput = document.getElementById("payments");
      var paymentInput = document.getElementById("payment");

      var hasPrincipal = principalInput.value.trim() !== "";
      var hasInterest = interestInput.value.trim() !== "";
      var hasPayments = paymentsInput.value.trim() !== "";
      var hasPayment = paymentInput.value.trim() !== "";

      var nonEmptyCount =
        (hasPrincipal ? 1 : 0) +
        (hasInterest ? 1 : 0) +
        (hasPayments ? 1 : 0) +
        (hasPayment ? 1 : 0);

      if (nonEmptyCount < 3) {
        errorEl.textContent =
          "Please enter at least three of the four values to calculate the missing one.";
        return;
      }

      // Parse numbers where present
      var P = hasPrincipal ? sn(principalInput.value) : null;
      var rAPR = hasInterest ? sn(interestInput.value) : null;
      var n = hasPayments ? sn(paymentsInput.value) : null;
      var PMT = hasPayment ? sn(paymentInput.value) : null;

      if (
        (hasPrincipal && P <= 0) ||
        (hasInterest && rAPR <= 0) ||
        (hasPayments && n <= 0) ||
        (hasPayment && PMT <= 0)
      ) {
        errorEl.textContent =
          "Values must be positive numbers. Please check your entries.";
        return;
      }

      // Annual rate -> monthly rate
      var rMonthly = hasInterest ? rAPR / 100 / 12 : null;

      // All four provided: recalc payment based on P, r, n
      if (nonEmptyCount === 4) {
        if (!hasPrincipal || !hasInterest || !hasPayments) {
          errorEl.textContent =
            "To recalculate the payment, principal, interest rate, and payments must all be entered.";
          return;
        }
        var powAll = Math.pow(1 + rMonthly, n);
        var newPMT = (P * powAll * rMonthly) / (powAll - 1);

        paymentInput.value = formatNumber(newPMT, 2);
        paymentInput.classList.add("highlight-input");
        return;
      }

      // Exactly one missing
      if (!hasPayment) {
        // Missing payment
        if (!hasPrincipal || !hasInterest || !hasPayments) {
          errorEl.textContent =
            "To solve for the payment, enter principal, interest rate, and number of payments.";
          return;
        }
        var powPmt = Math.pow(1 + rMonthly, n);
        var calcPMT = (P * powPmt * rMonthly) / (powPmt - 1);
        paymentInput.value = formatNumber(calcPMT, 2);
        paymentInput.classList.add("highlight-input");
      } else if (!hasPrincipal) {
        // Missing principal
        if (!hasInterest || !hasPayments) {
          errorEl.textContent =
            "To solve for the principal, enter interest rate, number of payments, and payment amount.";
          return;
        }
        var powPrin = Math.pow(1 + rMonthly, n);
        var calcP = ((powPrin - 1) * PMT) / (powPrin * rMonthly);
        principalInput.value = formatNumber(calcP, 2);
        principalInput.classList.add("highlight-input");
      } else if (!hasPayments) {
        // Missing number of payments
        if (!hasInterest || !hasPrincipal) {
          errorEl.textContent =
            "To solve for the number of payments, enter principal, interest rate, and payment amount.";
          return;
        }
        var ratio = PMT / (PMT - P * rMonthly);
        if (ratio <= 0) {
          errorEl.textContent =
            "Inputs result in an invalid payment schedule. Please check that payment amount is large enough to cover interest.";
          return;
        }
        var calcN = Math.log(ratio) / Math.log(1 + rMonthly);
        paymentsInput.value = formatNumber(calcN, 0);
        paymentsInput.classList.add("highlight-input");
      } else if (!hasInterest) {
        // Missing interest rate (APR)
        if (!hasPrincipal || !hasPayments) {
          errorEl.textContent =
            "To solve for the interest rate, enter principal, number of payments, and payment amount.";
          return;
        }
        var estAPR = computeIntRate(n, P, PMT, 10); // guess 10% APR
        interestInput.value = formatNumber(estAPR, 4);
        interestInput.classList.add("highlight-input");
      }
    }

    // ------- Info icon descriptions -------

    var loanTermTips = {
      principal: {
        title: "Principal (current payoff amount)",
        body:
          "This is the amount you are looking to borrow or the amount you still owe on the loan today — essentially the balance you would need to pay off in full to close the loan.",
        tip:
          "Tip: If you have a recent statement, look for the 'principal balance' or 'outstanding balance' line."
      },
      interest: {
        title: "Interest rate (APR, %)",
        body:
          "The annual percentage rate (APR) is the yearly cost of borrowing, expressed as a percentage. This calculator assumes a fixed rate and monthly compounding - typical for mortgage loans.",
        tip:
          "Tip: For mortgages and many auto loans, the APR is listed on your loan agreement and on your monthly statement."
      },
      payments: {
        title: "Number of payments remaining",
        body:
          "How many scheduled payments you have left on the loan. For example, a 30-year mortgage with monthly payments has 360 total payments and a 15-year mortgage with monthly payments has 180 total payments.",
        tip:
          "Tip: The total interest paid over the life of the loan is highly sensitive to this value. Paying off a loan faster can save significant interest."
      },
      payment: {
        title: "Payment amount",
        body:
          "Your regular scheduled payment for the loan, usually monthly. This includes principal and interest only, and does not include escrow items (taxes and insurance).",
        tip:
          "Tip: Use the Recommended Percents calculator (Budgeting section) for tips on suggested payments for your income level.",
        }
    };

    document
      .getElementById("missing-loan-form")
      .addEventListener("click", function (event) {
        var btn = event.target.closest(".info-btn");
        if (!btn) return;

        var field = btn.getAttribute("data-field");
        var info = loanTermTips[field];
        if (!info) return;

        var details = document.getElementById("loan-term-details");
        details.innerHTML =
          "<strong>" +
          info.title +
          "</strong><br>" +
          info.body +
          "<br><br><em>" +
          info.tip +
          "</em>";
      });
  </script>
</body>
</html>
